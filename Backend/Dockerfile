# Use official Node.js image with specific version
FROM node:22.14.0

# Set working directory
WORKDIR /app

# Copy dependency files and install dependencies
COPY package*.json ./
RUN npm install

# Copy the entire backend source code
COPY . .

# Expose your app's port
EXPOSE 5000

# Declare build-time variables (ARG)
ARG PORT
ARG SESSION_SECRET

# Google OAuth
ARG GOOGLE_OAUTH_URL
ARG GOOGLE_ACCESS_TOKEN_URL
ARG GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET
ARG GOOGLE_CALLBACK_URL
ARG GOOGLE_OAUTH_SCOPES

# URLs
ARG FRONTED_URL
ARG BACKEND_URL

# Wasabi S3
ARG WASABI_S3_ACCESS_ID
ARG WASABI_S3_SECRET_KEY
ARG WASABI_S3_REGION
ARG WASABI_S3_ENDPOINT

ARG SENDI_BLUE_API_KEY

# Supabase DB
ARG DATABASE_URL

# Set runtime environment variables (ENV)
ENV PORT=${PORT}
ENV SESSION_SECRET=${SESSION_SECRET}

ENV GOOGLE_OAUTH_URL=${GOOGLE_OAUTH_URL}
ENV GOOGLE_ACCESS_TOKEN_URL=${GOOGLE_ACCESS_TOKEN_URL}
ENV GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
ENV GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
ENV GOOGLE_CALLBACK_URL=${GOOGLE_CALLBACK_URL}
ENV GOOGLE_OAUTH_SCOPES=${GOOGLE_OAUTH_SCOPES}

ENV FRONTED_URL=${FRONTED_URL}
ENV BACKEND_URL=${BACKEND_URL}

ENV WASABI_S3_ACCESS_ID=${WASABI_S3_ACCESS_ID}
ENV WASABI_S3_SECRET_KEY=${WASABI_S3_SECRET_KEY}
ENV WASABI_S3_REGION=${WASABI_S3_REGION}
ENV WASABI_S3_ENDPOINT=${WASABI_S3_ENDPOINT}

ENV SENDI_BLUE_API_KEY=${SENDI_BLUE_API_KEY}

ENV DATABASE_URL=${DATABASE_URL}

# Start your app
CMD ["node", "app.js"]